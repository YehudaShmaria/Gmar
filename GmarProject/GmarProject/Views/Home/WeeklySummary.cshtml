
@{
    ViewBag.Title = "WeeklySummary";
}

<style>
.responstable {
    margin: 1em 0;
    width:50%;
    overflow: hidden;
    background: #fff;
    color: #024457;
    border-radius: 10px;
    border: 1px solid #167f92;
    margin-left: auto;
    margin-right: auto;
  }
  .responstable tr {
    border: 1px solid #d9e4e6;
  }
  .responstable tr:nth-child(odd) {
    background-color: #eaf3f3;
  }
  .responstable th {
    display: none;
    border: 1px solid #fff;
    background-color: #167f92;
    color: #fff;
    padding: 1em;
  }
  .responstable th:first-child {
    display: table-cell;
    text-align: right;
  }
  .responstable th:nth-child(2) {
    display: table-cell;
  }
  .responstable th:nth-child(2) span {
    display: none;
  }
  .responstable th:nth-child(2):after {
    content: attr(data-th);
  }
  @@media (min-width: 480px) {
    .responstable th:nth-child(2) span {
      display: block;
    }
    .responstable th:nth-child(2):after {
      display: none;
    }
  }
  .responstable td {
    display: block;
    word-wrap: break-word;
    max-width: 7em;
  }
  .responstable td:first-child {
    display: table-cell;
    text-align: right;
    border-right: 1px solid #d9e4e6;
  }
  @@media (min-width: 480px) {
    .responstable td {
      border: 1px solid #d9e4e6;
    }
  }
  .responstable th,
  .responstable td {
    text-align: right;
    margin: 0.5em 1em;
  }
  @@media (min-width: 480px) {
    .responstable th,
    .responstable td {
      display: table-cell;
      padding: 1em;
    }
  }
</style>

<div class="text-center">
    <h1 style="font-style:italic;font-size:50px" class="text-primary"><u>Weekly Summary</u></h1>
    <img onload="GetData()" style="height:100px;" src="~/Images/Week.jpg">
    <h1 style="display:none" id="Test5">Hi My Name Is Yehuda</h1>

    <div>
        <label for="w">תאריך:</label>
        <input id="w" type="date" placeholder="!!Enter you asnsher" class="form-control form-control-underlined border-danger">
        <button onclick="UpdateTheWeek()" style="display:inline-grid" class="btn btn-success">לחץ על מנת לקבל נתונים!!</button>

    </div>
    <div class="container">
        <table class="responstable"></table>
    </div>

</div>
<script>

    function UpdateTheWeek() {
        var week = $("#w").val();
        console.log(week);
        var User = "@HttpContext.Current.User.Identity.Name";
        var Url = 'http://localhost:3000/getdata/getDataForUser/'+User
        var xml = new XMLHttpRequest();
        xml.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200){
                var myArr = JSON.parse(this.responseText);
                GetTheWeek(myArr, week);
            }
        };
        xml.open('GET', Url, true)
        xml.send();
    }

    function GetTheWeek(Obj, Date) {
        for (var i = 0; i < Obj.Weeks.length; i++) {
            for (var z = 0; z < Obj.Weeks[i].length; z++) {
                if (Obj.Weeks[i][z].Date == Date) {
                    console.log('Yes');
                    var week = Obj.Weeks[i];
                    CreateTable(week)
                }
            }
        }
    }
  
    function Test2(Obj){
        $("#Test5").fadeIn(3000);
        console.log(Obj);
        var TheWeek = Obj.Weeks[Obj.Weeks.length - 1];
        CreateTable(TheWeek);
    }



    function CreateTable(Teachres) {
        var notShow = ['_id', 'CharacterNumber', 'LicenseTerms', 'RankSeniority', 'MoreDocuments', 'PreRank', 'TAB', 'MedicalStatment', 'AutomaticGreenRoad', 'ConfidentialRegistration', 'EyesTests', 'CriminalRecord'];
        let table = document.querySelector("table");
        table.innerHTML = '';
        console.log(Teachres)
        let data = Object.keys(Teachres[0]);
        generateTableHead(table, data);
        generateTable(table, Teachres);
        function generateTableHead(table, data) {
            let thead = table.createTHead();
            let row = thead.insertRow();
            for (let key of data) {
               
                let th = document.createElement("th");
                let text = document.createTextNode(key);
                th.appendChild(text);
                row.appendChild(th);
            }
        }
        function generateTable(table, data) {
            for (let element of data) {
                let row = table.insertRow();
                for (key in element) {
                    if (!notShow.includes(key)) {
                        let cell = row.insertCell();
                        let text = document.createTextNode(element[key]);
                        cell.appendChild(text);
                    }
                }
            }
        }
    }
</script>